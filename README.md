# WHOIS Lookup Service

ะะตะฒะตะปะธะบะธะน REST-API ัะฐ ะฒะตะฑ-ัะฝัะตััะตะนั ะดะปั ะพััะธะผะฐะฝะฝั WHOIS-ัะฝัะพัะผะฐััั ะฟัะพ ะดะพะผะตะฝ.
ะะพะทะณะพััะฐััััั ะทะฐ ะดะพะฟะพะผะพะณะพั Docker Compose (PHP-FPM + Nginx) ัะฐ ะฟะพะฑัะดะพะฒะฐะฝะธะน ะฝะฐ Laravel.

---

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัั

```
.
โโโ docker
โ   โโโ php
โ   โ   โโโ Dockerfile               # PHP-FPM ะพะฑัะฐะท ะท ัะพะทัะธัะตะฝะฝัะผะธ ะน Composer
โ   โโโ nginx
โ       โโโ Dockerfile               # Nginx ะฝะฐ Alpine
โ       โโโ default.conf             # ะะพะฝััะณ ะดะปั Laravel (root โ public)
โโโ config
โ   โโโ whois.php                    # ะััะพััะฐัะธะฒะฝะธะน ะผะฐัะธะฒ TLD โ WHOIS-ัะตัะฒะตั
โโโ docker-compose.yml               # ะะฟะธั ัะตัะฒัััะฒ php ัะฐ nginx
โโโ routes
โ   โโโ api.php                      # POST /api/whois
โ   โโโ web.php                      # GET / โ ัะพัะผะฐ ะฒะฒะตะดะตะฝะฝั ะดะพะผะตะฝั
โโโ app
โ   โโโ Http
โ   โ   โโโ Controllers
โ   โ   โ   โโโ WhoIsController.php  # ะะพะณัะบะฐ lookup ัะตัะตะท fsockopen()
โ   โ   โโโ Requests
โ   โ       โโโ LookupWhoIsRequest.php  # ะัะฐะฒะธะปะฐ ะฒะฐะปัะดะฐััั domain
โ   โโโ โฆ                            # ะกัะฐะฝะดะฐััะฝะธะน ะบะฐัะบะฐั Laravel
โโโ resources
โ   โโโ views
โ       โโโ whois
โ           โโโ form.blade.php       # HTML + JS ัะพัะผะฐ + ะบะฝะพะฟะบะฐ Download JSON
โโโ README.md                        # ะะฟะธั ะฟัะพะตะบัั
```

---

## โ๏ธ ะะฐะปะฐัััะฒะฐะฝะฝั ัะตัะตะดะพะฒะธัะฐ

1. **ะะปะพะฝััะผะพ ัะตะฟะพะทะธัะพััะน** ัะฐ ะฟะตัะตัะพะดะธะผะพ ะฒ ะฟะฐะฟะบั ะฟัะพะตะบัั:

   ```bash
   git clone git@github.com:USER/REPO.git
   cd REPO
   ```
2. **ะะฐะฟััะบะฐัะผะพ Docker-ััะตะบ**:

   ```bash
   docker-compose up -d --build
   ```
3. ะะตะฑ-ัะฝัะตััะตะนั ะดะพัััะฟะฝะธะน ะทะฐ ะฐะดัะตัะพั:

   ```
   http://localhost:8085
   ```

---

## ๐ ะฏะบ ะบะพัะธัััะฒะฐัะธัั

### ะะตะฑ-ัะฝัะตััะตะนั

1. ะะฒะตะดััั ะดะพะผะตะฝ ั ะฟะพะปั (ะฝะฐะฟัะธะบะปะฐะด, `example.com`).
2. ะะฐัะธัะฝััั **ะะตัะตะฒััะธัะธ**.
3. ะััะธะผะฐััะต โัะธััโ WHOIS-ะฒัะดะฟะพะฒัะดั ั ะฑะปะพัั `<pre>`.
4. ะะฐัะธัะฝััั ะบะฝะพะฟะบั **Download JSON** ะดะปั ะทะฑะตัะตะถะตะฝะฝั ะฟะพะฒะฝะพะณะพ JSON-ะพะฑโัะบัะฐ.

### REST-API

* **ะะฐััััั**: `POST /api/whois`
* **ะขัะปะพ ะทะฐะฟะธัั** (JSON):

  ```json
  { "domain": "example.com" }
  ```
* **ะฃัะฟััะฝะฐ ะฒัะดะฟะพะฒัะดั** (HTTP 200):

  ```json
  {
    "domain": "example.com",
    "server": "whois.verisign-grs.com",
    "whois": "โฆWHOIS-ัะตะบััโฆ"
  }
  ```
* **ะะพะผะธะปะบะธ**:

  * **422 Validation Error** (ะฝะตะฟัะฐะฒะธะปัะฝะธะน ัะพัะผะฐั domain)
  * **400 Bad Request** (TLD ะฝะต ะฟัะดััะธะผัััััั)
  * **503 Service Unavailable** (ะฝะต ะฒะดะฐะปะพัั ะทโัะดะฝะฐัะธัั)

---

## ๐ ะะตะฐะปัะทะฐััั

1. **Docker + Nginx**

   * PHP-FPM ะพะฑัะฐะท ัะท ะฑะฐะทะพะฒะธะผะธ ัะพะทัะธัะตะฝะฝัะผะธ (GD, PDO, mbstring, opcache, Xdebug).
   * Nginx ะฝะฐ Alpine, ัะบะธะน ะฟัะพะบัะธัั ะทะฐะฟะธัะธ `.php` ะฝะฐ `php:9000` ั ะฒัะดะดะฐั ััะฐัะธะบั.

2. **Laravel**

   * **ะะพะฝััะพะปะตั `WhoIsController`**:

     * `form()` โ ะฟะพะฒะตััะฐั view ะท ัะพัะผะพั.
     * `lookup()` โ ะพะฑัะพะฑะปัั ะทะฐะฟะธั, ะฒะฐะปัะดัั ัะตัะตะท `LookupWhoIsRequest`, ะฒะธะทะฝะฐัะฐั WHOIS-ัะตัะฒะตั ะทะฐ ะบะพะฝััะณะพะผ, ะฒัะดะบัะธะฒะฐั ัะพะบะตั ะดะพ ะฟะพััั 43, ัะธัะฐั ะฒัะดะฟะพะฒัะดั ั ะฒัะดะดะฐั JSON.
   * **FormRequest `LookupWhoIsRequest`**:

     * ะัะฐะฒะธะปะพ: `required|string|regex:/^[a-zA-Z0-9\.-]+\.[a-zA-Z]{2,}$/`.
     * ะัะธ ะฟะพะผะธะปัั ะฒะฐะปัะดะฐััั ะฟะพะฒะตััะฐั JSON 422.
   * **ะะพะฝััะณ `config/whois.php`**:

     * ะััะพััะฐัะธะฒะฝะธะน ะผะฐัะธะฒ ัััั TLD ัะท ะฒัะดะฟะพะฒัะดะฝะธะผะธ WHOIS-ัะตัะฒะตัะฐะผะธ (ะท ะฟะตัะตะปัะบั Nir Sofer).
   * **Blade-ัะฐะฑะปะพะฝ**:

     * ะคะพัะผะฐ ะดะปั ะฒะฒะตะดะตะฝะฝั ะดะพะผะตะฝั, JS-ััะฝะบััั `fetch` โ `/api/whois`.
     * ะะตะฝะตัะฐััั `Blob`โัะฐะนะปะฐ ัะฐ ะบะฝะพะฟะบะฐ **Download JSON**.

3. **ะะฑัะพะฑะบะฐ ะพัะพะฑะปะธะฒะธั ะฒะธะฟะฐะดะบัะฒ**

   * ะะฒัะพะผะฐัะธัะฝะธะน ะฒะธะฑัั ัะตัะฒะตััะฒ ะดะปั SLD (ะฝะฐะฟัะธะบะปะฐะด `com.ua`, `org.ua` ัะพัะพ) ะทะฐ ะดะฒะพะผะฐ ะตะปะตะผะตะฝัะฐะผะธ ะดะพะผะตะฝั.
   * ะะธะบะปััะฐัะผะพ ะฟัะตััะบั `=` ััะปัะบะธ ะดะปั `ru`; ะดะปั `ua` ัะฐ ัะฝัะธั ะฝะฐะดัะธะปะฐัะผะพ ะฟัะพััะธะน `domain\r\n`.

---

## ๐ง ะะพะดะฐัะบะพะฒั ะบะพะผะฐะฝะดะธ

* **ะะตัะตะทะฐะฟััะบ Nginx** (ัะพะฑ ะฟะตัะตัะธัะฐัะธ ะบะพะฝััะณ):

  ```bash
  docker-compose restart nginx
  ```

  ะฐะฑะพ

  ```bash
  docker-compose exec nginx nginx -s reload
  ```
* **ะกัะฒะพัะตะฝะฝั ะบะพะฝััะพะปะตัะฐ ะฟัะด ัะฒะพัะผ UID/GID**:

  ```bash
  docker-compose exec --user $(id -u):$(id -g) php php artisan make:controller WhoIsController
  ```

---

## ๐ค ะะฐะปั

* ะะตััะฒะฐัะธ ะบะพะฝััะณ `whois.php` ะดะปั ะฟัะดะฒะธัะตะฝะฝั ัะฒะธะดะบะพะดัั.
* ะะพะดะฐัะธ ะพะฑัะพะฑะบั DNS-cache ัะฐ rate limiting.
* ะะพะทัะธัะธัะธ ะฒะฐะปัะดะฐััั (IDN-ะดะพะผะตะฝัะฒ, ะฝะพะฒั TLD).
* ะะบัะตะผะธะน PHPUnit-ัะตัั ะดะปั ะบะพะฝััะพะปะตัะฐ ัะฐ FormRequest.

---

> **ะะฒัะพั:** ะบะพะผะฐะฝะดะฐ ัะพะทัะพะฑะบะธ
> **ะะฐัะฐ:** ััะฐะฒะตะฝั 2025
> **ะััะตะฝะทัั:** MIT

